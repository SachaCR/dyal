<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>DYAL - v1.0.0</title><meta name="description" content="Documentation for DYAL - v1.0.0"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">DYAL - v1.0.0</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>DYAL - v1.0.0</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#dyal" id="dyal" style="color: inherit; text-decoration: none;">
  <h1>DYAL</h1>
</a>
<p>Simple application layer framework with CQRS tooling</p>
<p>This framework helps you Decouple Your Application Layer (DYAL) from your presentation layer.</p>
<p>It is inspired from Koa for the middlewares implementation except that it does not couple your application to HTTP presentation layer.
It let you free to choose any way to expose your app commands with HTTP, CLI, gRPC, etc...</p>

<a href="#documentation" id="documentation" style="color: inherit; text-decoration: none;">
  <h1>Documentation:</h1>
</a>
<ul>
<li><a href="https://sachacr.github.io/dyal/">Type Documentation</a></li>
<li><a href="https://sachacr.github.io/dyal/jest/lcov-report/index.html">Code Coverage Report</a></li>
<li><a href="https://sachacr.github.io/dyal/features/reports/index.html">Cucumber Tests Report</a></li>
</ul>

<a href="#basic-example" id="basic-example" style="color: inherit; text-decoration: none;">
  <h1>Basic Example:</h1>
</a>
<pre><code class="language-typescript"><span class="hl-8">// Declare the dependencies you will inject into your app.</span><br/><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-3">AppDependencies</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">database</span><span class="hl-1">: </span><span class="hl-3">DBConnection</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">logger</span><span class="hl-1">: </span><span class="hl-3">Logger</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-8">// Build the app and inject dependencies.</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">app</span><span class="hl-1"> = </span><span class="hl-5">createApp</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">database</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">logger</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// Mount handlers and middelwares to handle you app&#39;s use cases.</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-5">use</span><span class="hl-1">(</span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-4">ctx</span><span class="hl-1">: </span><span class="hl-3">any</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">results</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">dependencies</span><span class="hl-1">.</span><span class="hl-4">database</span><span class="hl-1">.</span><span class="hl-5">query</span><span class="hl-1">(</span><span class="hl-7">&#39;SELECT * FROM ...&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-4">results</span><span class="hl-1">;</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#typed-context-example" id="typed-context-example" style="color: inherit; text-decoration: none;">
  <h1>Typed Context Example:</h1>
</a>
<p>You can type your handler context to know which <code>UseCase</code> it will handle, what <code>result</code> it must return and which are the <code>dependencies</code> that are available on the context.</p>
<pre><code class="language-typescript"><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-3">CountCommandContext</span><span class="hl-1"> = </span><span class="hl-3">Context</span><span class="hl-1">&lt;</span><br/><span class="hl-1">  </span><span class="hl-3">AppDependencies</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">CountCommand</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">CountCommandResult</span><br/><span class="hl-1">&gt;;</span><br/><br/><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-3">AppDependencies</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">logger</span><span class="hl-1">: </span><span class="hl-3">Logger</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-0">interface</span><span class="hl-1"> </span><span class="hl-3">CountCommand</span><span class="hl-1"> </span><span class="hl-0">extends</span><span class="hl-1"> </span><span class="hl-3">Command</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-7">&#39;CountCommand&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">payload</span><span class="hl-1">: { </span><span class="hl-4">count</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1"> };</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-0">interface</span><span class="hl-1"> </span><span class="hl-3">CountCommandResult</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">total</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-5">countCommandHandler</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">ctx</span><span class="hl-1">: </span><span class="hl-3">CountCommandContext</span><span class="hl-1">,</span><br/><span class="hl-1">): </span><span class="hl-3">Promise</span><span class="hl-1">&lt;</span><span class="hl-3">CountCommandResult</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">logger</span><span class="hl-1"> = </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">dependencies</span><span class="hl-1">.</span><span class="hl-4">logger</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">logger</span><span class="hl-1">(</span><span class="hl-7">&#39;Command handler&#39;</span><span class="hl-1">, </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">useCase</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">return</span><span class="hl-1"> { </span><span class="hl-4">total:</span><span class="hl-1"> </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">useCase</span><span class="hl-1">.</span><span class="hl-4">payload</span><span class="hl-1">.</span><span class="hl-4">count</span><span class="hl-1"> + </span><span class="hl-9">1</span><span class="hl-1"> };</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Also DYAL allows you to implement CQRS pattern by providing a command bus and query bus utilities.
Notice that you are not forced to use them and you can write your own middlewares to handle use cases on your app.</p>

<a href="#cqrs-example" id="cqrs-example" style="color: inherit; text-decoration: none;">
  <h1>CQRS Example:</h1>
</a>
<p>You can retrieve the full example here on github</p>
<pre><code class="language-typescript"><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dependencies</span><span class="hl-1">: </span><span class="hl-3">AppDependencies</span><span class="hl-1"> = { </span><span class="hl-4">logger:</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1"> };</span><br/><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">app</span><span class="hl-1"> = </span><span class="hl-5">createApp</span><span class="hl-1">(</span><span class="hl-4">dependencies</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">commandBus</span><span class="hl-1">: </span><span class="hl-3">CommandBus</span><span class="hl-1"> = </span><span class="hl-5">createCommandBus</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-4">commandBus</span><span class="hl-1">.</span><span class="hl-5">register</span><span class="hl-1">(</span><span class="hl-7">&#39;CountCommand&#39;</span><span class="hl-1">, </span><span class="hl-4">countCommandHandler</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">queryBus</span><span class="hl-1">: </span><span class="hl-3">QueryBus</span><span class="hl-1"> = </span><span class="hl-5">createQueryBus</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-4">queryBus</span><span class="hl-1">.</span><span class="hl-5">register</span><span class="hl-1">(</span><span class="hl-7">&#39;GetCountQuery&#39;</span><span class="hl-1">, </span><span class="hl-4">getCountQueryHandler</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-5">use</span><span class="hl-1">(</span><span class="hl-4">loggerMiddleware</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-7">&#39;command&#39;</span><span class="hl-1">).</span><span class="hl-5">use</span><span class="hl-1">(</span><span class="hl-4">commandBus</span><span class="hl-1">.</span><span class="hl-4">middleware</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-7">&#39;query&#39;</span><span class="hl-1">).</span><span class="hl-5">use</span><span class="hl-1">(</span><span class="hl-4">queryBus</span><span class="hl-1">.</span><span class="hl-4">middleware</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">countCommand</span><span class="hl-1">: </span><span class="hl-3">CountCommand</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">actionType:</span><span class="hl-1"> </span><span class="hl-7">&#39;command&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-7">&#39;CountCommand&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">payload:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">count:</span><span class="hl-1"> </span><span class="hl-9">5</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  };</span><br/><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">resultCount</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-5">execute</span><span class="hl-1">&lt;</span><span class="hl-3">CountCommandResult</span><span class="hl-1">&gt;(</span><span class="hl-4">countCommand</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-7">&#39;resultCount:&#39;</span><span class="hl-1">, </span><span class="hl-4">resultCount</span><span class="hl-1">.</span><span class="hl-4">total</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">resultGetCount</span><span class="hl-1">: </span><span class="hl-3">GetCountQueryResult</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-5">execute</span><span class="hl-1">(</span><span class="hl-4">getCountQuery</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-7">&#39;resultGetCount:&#39;</span><span class="hl-1">, </span><span class="hl-4">resultGetCount</span><span class="hl-1">.</span><span class="hl-4">count</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#middlewares" id="middlewares" style="color: inherit; text-decoration: none;">
  <h1>Middlewares:</h1>
</a>
<p>You can create your own middleware like this:</p>
<pre><code class="language-typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dependencies</span><span class="hl-1">: </span><span class="hl-3">AppDependencies</span><span class="hl-1"> = { </span><span class="hl-4">logger:</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1"> };</span><br/><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-5">myLoggerMiddleware</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">ctx</span><span class="hl-1">: </span><span class="hl-3">Context</span><span class="hl-1">&lt;</span><span class="hl-3">any</span><span class="hl-1">, </span><span class="hl-3">AppDependencies</span><span class="hl-1">, </span><span class="hl-3">any</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-4">next</span><span class="hl-1">: </span><span class="hl-3">Next</span><span class="hl-1">,</span><br/><span class="hl-1">): </span><span class="hl-3">Promise</span><span class="hl-1">&lt;</span><span class="hl-3">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">logger</span><span class="hl-1"> } = </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">dependencies</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">logger</span><span class="hl-1">(</span><span class="hl-7">`Executing use case: </span><span class="hl-0">${</span><span class="hl-4">ctx</span><span class="hl-10">.</span><span class="hl-4">useCase</span><span class="hl-10">.</span><span class="hl-4">type</span><span class="hl-0">}</span><span class="hl-7"> </span><span class="hl-0">${</span><span class="hl-4">ctx</span><span class="hl-10">.</span><span class="hl-4">useCase</span><span class="hl-10">.</span><span class="hl-4">name</span><span class="hl-0">}</span><span class="hl-7">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-5">next</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">app</span><span class="hl-1"> = </span><span class="hl-5">createApp</span><span class="hl-1">(</span><span class="hl-4">dependencies</span><span class="hl-1">);</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-5">use</span><span class="hl-1">(</span><span class="hl-4">myLoggerMiddleware</span><span class="hl-1">);</span>
</code></pre>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-interface"><a href="interfaces/Command.html" class="tsd-kind-icon">Command</a></li><li class="tsd-kind-interface"><a href="interfaces/CommandBus.html" class="tsd-kind-icon">Command<wbr/>Bus</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/Context.html" class="tsd-kind-icon">Context</a></li><li class="tsd-kind-interface"><a href="interfaces/DyalApp.html" class="tsd-kind-icon">Dyal<wbr/>App</a></li><li class="tsd-kind-interface"><a href="interfaces/Query.html" class="tsd-kind-icon">Query</a></li><li class="tsd-kind-interface"><a href="interfaces/QueryBus.html" class="tsd-kind-icon">Query<wbr/>Bus</a></li><li class="tsd-kind-type-alias"><a href="modules.html#Middleware" class="tsd-kind-icon">Middleware</a></li><li class="tsd-kind-type-alias"><a href="modules.html#Next" class="tsd-kind-icon">Next</a></li><li class="tsd-kind-type-alias"><a href="modules.html#UseCase" class="tsd-kind-icon">Use<wbr/>Case</a></li><li class="tsd-kind-type-alias"><a href="modules.html#UseCaseType" class="tsd-kind-icon">Use<wbr/>Case<wbr/>Type</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#createApp" class="tsd-kind-icon">create<wbr/>App</a></li><li class="tsd-kind-function"><a href="modules.html#createCommandBus" class="tsd-kind-icon">create<wbr/>Command<wbr/>Bus</a></li><li class="tsd-kind-function"><a href="modules.html#createQueryBus" class="tsd-kind-icon">create<wbr/>Query<wbr/>Bus</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>